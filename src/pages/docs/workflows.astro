---
import Layout from '../../layouts/Layout.astro';
import { Accordion, AccordionItem, AccordionTrigger, AccordionContent } from "@/components/ui/accordion";
---

<Layout title="Workflows & Actions">
    <div class="space-y-8">
        <div>
            <h1 class="text-3xl font-bold tracking-tight">Workflows</h1>
            <p class="text-muted-foreground mt-2">Detailed guide to automated agent actions.</p>
        </div>

        <div class="space-y-4">
            <h2 class="text-2xl font-semibold">Command Routing</h2>
            <div class="bg-card border rounded-lg p-6 space-y-4">
                <p class="text-sm text-muted-foreground">
                    The bot now intelligently routes commands based on your intent. Mention <code>@colby-bot</code> in a PR or Issue comment.
                </p>
                <ul class="text-sm text-muted-foreground list-disc pl-4 space-y-1">
                    <li><strong>Fix Code:</strong> "@colby-bot fix this error" -> Routes to ReviewBot.</li>
                    <li><strong>Resolve Conflict:</strong> "@colby-bot merge conflict" -> Routes to ConflictResolver.</li>
                    <li><strong>Check Status:</strong> "@colby-bot check status" -> Routes to DeploymentVerifier.</li>
                </ul>
            </div>
        </div>

        <div class="space-y-4">
             <h2 class="text-2xl font-semibold">Auto-Pilot Configuration</h2>
             <div class="bg-card border rounded-lg p-6 space-y-4">
                 <p class="text-sm text-muted-foreground">
                    Pushes that modify <code>wrangler.toml</code> or <code>wrangler.jsonc</code> automatically trigger the <strong>ConfigurationAgent</strong> to validate bindings and best practices.
                 </p>
             </div>
        </div>

        <div class="space-y-4">
            <h2 class="text-2xl font-semibold">PR Code Repair</h2>
            <div class="bg-card border rounded-lg p-6 space-y-4">
                <div class="grid md:grid-cols-3 gap-6">
                    <div>
                        <h3 class="font-medium text-primary mb-2">Trigger</h3>
                        <p class="text-sm text-muted-foreground">
                            <strong>Event:</strong> `issue_comment` (created)<br/>
                            <strong>Condition:</strong> Comment starts with `/fix` or mentions the bot on a PR code snippet.
                        </p>
                    </div>
                    <div>
                         <h3 class="font-medium text-primary mb-2">Process</h3>
                         <ul class="text-sm text-muted-foreground list-disc pl-4 space-y-1">
                            <li>Fetch PR diff & file content</li>
                            <li>Prompt AI (PromptImprover -> RepairAgent)</li>
                            <li>Generate patch code</li>
                            <li>Verify syntax in Sandbox (optional)</li>
                         </ul>
                    </div>
                    <div>
                         <h3 class="font-medium text-primary mb-2">Output</h3>
                         <p class="text-sm text-muted-foreground">
                            A new commit pushed to the PR branch with the fix, or a reply comment explaining why the fix failed.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            <h2 class="text-2xl font-semibold">Troubleshooting & FAQ</h2>
            <Accordion type="single" collapsible className="w-full">
                <AccordionItem value="item-1">
                    <AccordionTrigger>Why is the bot not replying?</AccordionTrigger>
                    <AccordionContent>
                        Check the <a href="/docs/github-app" class="underline">GitHub App Configuration</a>. Ensure the Webhook URL is correct and the `issue_comment` event is subscribed. Check the "Dashboard" logs for errors.
                    </AccordionContent>
                </AccordionItem>
                <AccordionItem value="item-2">
                     <AccordionTrigger>Deployments are failing verification</AccordionTrigger>
                    <AccordionContent>
                        The DeploymentVerifierAgent analyzes build logs. Ensure your `wrangler.json` `observability` is enabled and the `BROWSER` binding is valid if taking screenshots.
                    </AccordionContent>
                </AccordionItem>
            </Accordion>
        </div>
    </div>
</Layout>
